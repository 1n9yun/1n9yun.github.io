---
layout: post
title: Refactor STEW(2) - 할 일 생각하기
category:
    - log
    - develop
tags:
    - stew
description: >
  SSAFY에서의 첫 프로젝트 [STEW](/project/2020-07-13-stew/)의 리팩토링 과정  

  할 일 생각하기
sitemap: false
---
# Refactor STEW(2) - 할 일 생각하기

* toc
{:toc}

## 시작하기 전에

### 나불나불

매일 블로그에 남길만 한 작업을 하겠다 결심했었는데, 쉽지 않다.  

퇴근하고 오면 7시, 밥먹고 뭐하고 하다보면 8시..  

8시 ~ 12시 정도 앉아서 뭘 하긴 한다. 근데 왜이렇게 효율이 안나오는지 모르겠다.  

이번 포스트도 의미있는 작업들을 해서 쓰는 게 아니라 쓸 때가 지나가는 것 같아서 쓴다..

### 선요약

* **테스트 코드를 작성**해야 한다.
* **RestDocs를 이용한 API의 문서화**
* 앞으로 할 일

## 오늘 한 일

오랜만에 프로젝트를 들여다보니 당장 고치고 싶은 부분들은 매우 많았고 테스트 코드 작성은 지루한 일이니까 마음가는 대로 할까 생각이 들었다..

그럼에도 불구하고 제일 먼저 테스트 코드를 작성해야겠다고 생각한 이유는 명확했다.

프로젝트 당시에도 느꼈던 테스트 코드의 필요성, 내가 작성 중인 이 컨트롤러가 내가 원하는 결과를 낳는가?  
그것을 확인하려면 서버를 켜고 포스트맨을 켜서 토큰 넣고, 요청 파라미터 넣고, 응답 필드들 확인하고, 헤더 확인하고... 직접 보기도 힘들고, 틀린 채로 넘어가는 경우도 있을 수 있다. (오타나, 응답 필드가 많으면 한 두개 빼먹는다던지.. 심지어 A를 수정했더니 B에서 에러가 터져나온다던지..)

테스트 코드의 작성은 이 부분을 어느정도 자동화를 하여 헤매는 경우를 많이 줄여줄 것이다.  
아무튼.. 기본에 충실한 길로 가도록 하자..

### Test 계획

우선 테스트 작성은 익숙한 Junit, RestDocs, mockMvc를 이용한 정적 테스트와 문서화, 높은 코드 커버리지를 목표로 할 것이다. 하지만 코드 커버리지같은 경우 의미 없는 자명한 결과에 대한 테스트 작성은 오히려 능률을 떨어뜨릴 것이므로 우선순위를 낮게 잡도록 할 것이다.  
그리고 오랜만에 테스트에 관한 것들을 찾아보다가, spock이란걸 알게됐는데, 동적인 테스트 BDD를 수행할 수 있다고 하는데,, 내가 지금 하려는 건 리팩토링이니 해보고 싶지만 다음으로 미루겠다.

맨날 해보고싶은거 닥치는대로 하다가 결국 늘어져서 원래 목표가 무색해졌던 경험이 더러 있었다.

그리고 테스트 작성과 더불어 API 문서화도 하려고 한다. 이 프로젝트 당시에도 문서화를 하긴 했었다. `Swagger`를 이용해서.

`Swagger`는 API를 테스트해 볼 수 있는 UI를 제공하고, 적용도 쉬워 이용했었는데, 물론 나는 시간에 쫓겨 많이 사용해보지 못했었고 비즈니스 코드 사이사이에 문서화를 위한 코드들이 섞인다는게 마음에 안들었었다.

그리고 `RestDocs`는 올해 초에 혼자 공부하면서 알게됐는데, 서비스 코드들과 문서화 코드가 분리되고 테스트와 연동되어 실제 API 스펙과 문서화 된 스펙의 일관성을 유지해주는 방식이 내 가치관과 맞아서 적용하기 어려워도 좋은 방식이라 생각한 적이 있다.

아무튼 `RestDocs`는 테스트가 실패하면 문서화가 되지 않는다. 또한 문서화가 실패하면 테스트가 실패한다.(?)  
다시말해서, 테스트의 결과가 문서화하려는 API의 스펙과 다르면 테스트가 실패한다.

결과적으로, 문서화 라이브러리는 `RestDocs` 당첨!